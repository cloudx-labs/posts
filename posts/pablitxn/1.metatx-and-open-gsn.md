---
title: "Meta-transacciones y Open GSN: c贸mo enviar gasless-transactions."
published: false
description: C贸mo realizar meta-transacciones utilizando Open Zeppelin y Open GSN.
tags: "soldity, metatx, open-gsn, gasless-transactions"
cover_image: ./assets/1.cover.png
---

# Meta-transacciones y Open GSN: c贸mo enviar gasless-transactions.

Todas las transacciones de Ethereum utilizan gas, y el remitente de cada transacci贸n debe tener suficiente _Ether_ para pagar por el gas utilizado.

Open GSN es alternativa para que nuestros usuarios puedan realizar transacciones en nuestros contratos, sin preocuparse por el pago del gas que ello implicaria: el camino para esto es a trav茅s del uso de meta-transacciones.

Vamos a explorar c贸mo crear una dApp compatible con meta-transacciones. Utilizaremos un servidor de retransmisi贸n basado en Open GSN y una crearemos una aplicaci贸n compatible con el est谩ndar.

## Indice

驴Qu茅 son las meta-transacciones?

Open GSN

驴C贸mo crear una dApp compatible con Open GSN?

dApp de Ejemplo

1. Setup del Proyecto
2. Gas Station Network
3. dApp compatible con Open GSN
4. Probando nuestra dApp realizando meta-transacciones

C贸mo seguir

Links de inter茅s

## 驴Qu茅 son las meta-transacciones?

Una metatransacci贸n es un nombre elegante para una idea simple: un servidor de retransmisi贸n puede enviar la transacci贸n de un usuario y pagar el costo del combustible. **En lugar de firmar una transacci贸n de Ethereum, que requerir铆a ETH para el gas, un usuario firma un mensaje que contiene informaci贸n sobre una transacci贸n que le gustar铆a ejecutar y lo env铆a a un servidor de retransmisi贸n off-chain.**

![Imagen de ejemplo](./assets/1.example-image_01.png)

<aside>
 *En lugar de firmar una transacci贸n de Ethereum, que requerir铆a ETH para el gas, un usuario firma un mensaje que contiene informaci贸n sobre una transacci贸n que le gustar铆a ejecutar y lo env铆a a un servidor de retransmisi贸n off-chain.*

</aside>

## Open GSN

Gas Station Network (GSN) es una red descentralizada de repetidores. Nos permite crear dApps en donde podemos hacernos cargo del pago de las transacciones de nuestros usuarios.

Consta de una red de repetidores que participan de la red a cambio de un incentivo econ贸mico que se cobra a trav茅s de las comisiones de cada transacci贸n.

<aside>
锔 En nuestro ejemplo el **servidor de retransmisi贸n** es una implementaci贸n adaptada de [Open GSN](https://github.com/opengsn/gsn/tree/master/packages/relay).

</aside>

## 驴C贸mo crear una dApp compatible con Open GSN?

Nos interesa poder crear una aplicaci贸n donde nuestros usuarios no paguen por las transacciones que realizan hacia nuestros contratos. Para ello vamos a usar la implementaci贸n del estandar `ERC-2771` de [Open Zeppelin](https://docs.openzeppelin.com/contracts/4.x/api/metatx#ERC2771Context), que nos permitir谩 recibir meta-transacciones en nuestros contratos.

Tambien vamos a usar la librer铆a `@opengsn/provider` para crear una instancia del Relay Provider y con ella poder interactuar de forma segura con el est谩ndar.

<aside>
 Ac谩 te voy a mostrar los archivos claves de la implementaci贸n. Si quer茅s ver m谩s, pod茅s consultar todo el [c贸digo en github](https://github.com/cloudx-labs/dapp-with-gsn).
En la proxima secci贸n vamos a explicar r谩pidamente como instalar y probar este ejemplo

</aside>

```jsx
// TODO: screenshots de codigo
1`contrato compatible con ERC2771`
1`qu茅 es _msgSender()`
2`c贸mo se verifica la firma dentro del ERC2771`
2`conectandonos a opengs`
1`creando una instancia del provider`
2`instanciamos el contrato con el provider`
3`creamos un hook para nuestra dApp`
```

## i. Setup para el proyecto

Para poder correr el servidor de retransmisi贸n y la dApp en nuestra m谩quina, vamos a necesitar:

Node 16

```bash
node --version
# v16.15.1
```

Los paquetes `make` `node-gyp` y `ganache-cli` instalados de forma global

```bash
npm install --location=global make node-gyp
```

Crear una red de pruebas con `ganache-cli`, y apuntar la llave privada.

```bash
ganache-cli --accounts 1
```

> \*Ganache CLI v6.12.2 (ganache-core: 2.13.2)

# Available Accounts

(0) 0x853ccF6e21A6afb17d17026f5352265C5D8950bF (100 ETH)

# Private Keys

(0) 0x991048192d5406ab045be83bc43f46d7dc0dce6f18c3bf00df28a542b5069864
Listening on 127.0.0.1:8545\*

>

## ii. Gas Station Network

Para poder desarrollar nuestra dApp compatible con GSN, utilizaremos una implementaci贸n basada en el protocolo de Open GSN. Para ello:

1. Clonamos el repositorio de github

```json
git clone git@github.com:cloudx-labs/minimal-gsn.git
```

1. Instalamos los paquetes con NPM

```json
npm install --legacy-peer-deps
```

1. Configuramos las variables de entorno en el archivo `.env`

```bash
# Asignamos los valores que nos provee ganache-cli
ETHEREUM_NODE_URL="http://127.0.0.1:8545"
ACCOUNT_PRIVATE_KEY="*0x991048192d5406ab045be83bc43f46d7dc0dce6f18c3bf00df28a542b5069864*"
CHAIN_ID=1337
DEVELOPER_ADDRESS="*0x853ccF6e21A6afb17d17026f5352265C5D8950bF*"
# Definimos el puerto la ruta para nuestro servidor de retransmisi贸n
RELAY_SERVER_URL="http://localhost:8090"
# Dejamos algunas configuraciones por defecto (quitar)
BATCH_GATEWAY="0x0000000000000000000000000000000000000001"
BURN_ADDRESS="0x0000000000000000000000000000000000000001"
```

1. Deployamos nuestros contratos

```bash
npx hardhat run scripts/deploy.ts
```

1. Buildeamos e iniciamos nuestra aplicaci贸n

```bash
npm run build && npm run start
```

1. Por ultimo, en otra termiinal vamos a correr un script para configurar el servidor de retransmisi贸n

```bash
npx hardhat run scripts/config-relay-server.ts
```

> _Manager wallet address: 0x823b962f435d64115910781b3fff3424542a228d
> Worker wallet address: 0x9e7bf5f5d80fa9f063dddda1c3cf3cf3135cbe97
> Deployer wallet address: 0x853ccF6e21A6afb17d17026f5352265C5D8950bF
> 1 - Send ether to Manager: 锔
> 2 - Approve StakeManager to send $GSN: 锔
> 3 - Send ether to Worker: 锔
> 4 - Stake tokens: 锔
> 5 - Set minimun stake: 锔
> 6 - Authorize hub: 锔
> 7 - Set Relay hub : 锔
> 8 - Set Trusted forwarder : 锔
> 9 - Deposit paymaster: 锔
> 10 - Register domain separator type: 锔
> 11 - Register request type: 锔
> Relay server: 锔_

> warn: Worker Balance requirement is now satisfied
> Worker Balance | good | actual: 2 ETH | required: 0.1 ETH
> warn: Relayer state: READY

## iii. dApp compatible con Open GSN

1. Clonamos el repositorio de github

```bash
git clone git@github.com:cloudx-labs/dapp-with-gsn.git
```

1. Instalamos los paquetes con NPM

```bash
npm install --legacy-peer-deps
```

1. Set enviroment variables in `.env.local` file

```bash
DEV_NODE_URL="http://localhost:8545"
DEV_ACCOUNT_PRIVATE_KEY="0x0000000000000000000000000000000000000001"
DEV_CHAIN_ID=1337

PAYMASTER_ADDRESS="0x0000000000000000000000000000000000000001"
FORWARDER_ADDRESS="0x0000000000000000000000000000000000000001"
CONTRACT_ADDRESS=""
```

1. Deploy contrats

```bash
npx hardhat run scripts/deploy.ts --network *your-network-config*
```

> Counter Contract deployed at: "0x0000000000000000000000000000000000000001"

1. Set the contract address in `.env.local` file

```bash
COUNTER_ADDRESS="0x0000000000000000000000000000000000000001"
```

1. Running dApp

```bash
npm run dev
```

## iv. Probando nuestra dApp realizando meta-transacciones

![1.screen-recording_01.gif](./assets/1.screen-recording_01.gif)

## C贸mo seguir

## Links de inter茅s

[Meta transaction explanation Open Zeppelin](https://docs.openzeppelin.com/learn/sending-gasless-transactions)

[EIP-712](https://eips.ethereum.org/EIPS/eip-712)

[Gas Station Network explanation](https://docs.opengsn.org/)

[Open GSN Protocol](https://github.com/opengsn/gsn-protocol/blob/master/gsn-protocol.md)

[Argen protocol metatx](https://github.com/argentlabs/argent-contracts/blob/develop/specifications/specifications.pdf)
